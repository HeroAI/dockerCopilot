syntax = "v1"

type DoLoginReq {
	SecretKey string `form:"secret_key,optional"`
}
type LoginReq {
	SecretKey string `form:"secretKey,optional"`
}
type VerifyJwtReq {
	Jwt string `form:"jwt,optional"`
}
type GetProgressReq {
	TaskId string `path:"taskid"`
}
type StartContainerReq {
	Name string `json:"name"`
}
type StopContainerReq {
	Name string `json:"name"`
}
type RenameContainerReq {
	OldName string `json:"oldName"`
	NewName string `json:"newName"`
}
type CreateContainerReq {
	OldName         string `json:"old_name"`
	NewName         string `json:"new_name"`
	ImageNameAndTag string `json:"image_name_and_tag"`
}
type RemoveContainerReq {
	Name string `json:"name"`
}
type getNewImageReq {
	ImageNameAndTag string `json:"image_name_and_tag"`
}
type MsgResp {
	Status string `json:"status"`
	Msg    string `json:"msg"`
}
type Resp {
	Code int `json:"code"`
	Msg string `json:"msg"`
	Data interface{} `json:"data"`
}

type IdReq {
	Id string `path:"id"`
}

type ContainerRestoreReq {
	Filename string `path:"filename"`
}

type ContainerRenameReq {
	IdReq
	NewName string `form:"newName"`
}

type RemoveImageReq {
	IdReq
	Force bool `form:"force,default=false"`
}

type ContainerUpdateReq {
	IdReq
	DelOldContainer bool `form:"delOldContainer,default=true"`
	Proxy string `form:"proxy,optional"`
	ImageNameAndTag string `form:"imageNameAndTag"`
	ContainerName string `form:"containerName"`
}

type VersionMsgResp {
	Version   string `json:"version"`
	BuildDate string `json:"build_date"`
}

service dokcerCopilot {
	@handler webindex
	get / () returns ()
}

@server(
	prefix: /
	group: Login
	middleware: IndexCheckMiddleware
)
service dokcerCopilot {
	@handler DoLogin
	post /login (DoLoginReq) returns ()

	@handler LoginIndex
	get /login () returns ()
}

@server(
	prefix: /containersManager
	group: containersManager
	middleware: CookieCheckMiddleware
)
service dokcerCopilot {
	@handler ContainersManagerIndex
	get / () returns ()

	@handler StartContainer
	post /start_container (StartContainerReq) returns (MsgResp)

	@handler StopContainer
	post /stop_container (StopContainerReq) returns (MsgResp)

	@handler RenameContainer
	post /rename_container (RenameContainerReq) returns (MsgResp)

	@handler CreateContainer
	post /create_container (CreateContainerReq) returns (MsgResp)

	@handler RemoveContainer
	post /remove_container (RemoveContainerReq) returns (MsgResp)
}

@server(
	prefix: /imagesManager
	group: imagesManager
	middleware: CookieCheckMiddleware
)
service dokcerCopilot {
	@handler imagesManagerIndex
	get / () returns ()

	@handler getNewImage
	post /get_new_image (getNewImageReq) returns (MsgResp)

	@handler RemoveImage
		post /remove_image (RemoveImageReq) returns (MsgResp)
}

@server(
	prefix: /api
	group: auth
)
service dokcerCopilot {
	@handler Login
	post /auth (LoginReq) returns (Resp);

	@handler JwtValidate
	get /auth/validate (LoginReq) returns (Resp);
}

@server(
	prefix: /api
	group: progress
)
service dokcerCopilot {
	@handler GetProgress
	get /progress/:taskid (GetProgressReq) returns (Resp);
}

@server(
	prefix: /api
	group: container
	middleware: BearerTokenCheckMiddleware
)
service dokcerCopilot {
	@handler list
	get /containers returns (Resp)

	@handler start
		post /container/:id/start (IdReq) returns (Resp)

	@handler stop
		post /container/:id/stop (IdReq) returns (Resp)

	@handler restart
		post /container/:id/restart (IdReq) returns (Resp)

	@handler rename
	post /container/:id/rename (ContainerRenameReq) returns (Resp)

	@handler update
	post /container/:id/update (ContainerUpdateReq) returns (Resp)

	@handler backup
	get /container/backup returns (Resp)

	@handler listBackups
	get /container/listBackups returns (Resp)

	@handler restore
	post /container/backups/:filename/restore (ContainerRestoreReq) returns (Resp)
}

@server(
	prefix: /api
	group: image
	middleware: BearerTokenCheckMiddleware
)
service dokcerCopilot {
	@handler list
	get /images returns (Resp)

	@handler remove
		delete /image/:id (RemoveImageReq) returns (Resp)
}

@server(
	prefix: /api
	group: version
	middleware: BearerTokenCheckMiddleware
)
service dokcerCopilot {
	@handler version
	get /version () returns (Resp);

	@handler checkForUpdates
	get /check () returns (Resp);

	@handler updateProgram
	put /program () returns (Resp);
}